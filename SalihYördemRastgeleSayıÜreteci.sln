import time

class CollatzRNG:
    def __init__(self, seed=None):
        """
        RNG'yi başlatır. Eğer seed verilmezse o anki zamanı kullanır.
        """
        if seed is None:
            self.state = int(time.time() * 1000)
        else:
            self.state = seed
        
        # Başlangıçtaki state 0 veya negatif olmamalıdır
        if self.state <= 0:
            self.state = 123456  # Varsayılan güvenli bir başlangıç

    def _collatz_step(self):
        """
        Bir sonraki Collatz adımını hesaplar ve durumu günceller.
        Kural: Çift ise n/2, Tek ise 3n+1
        """
        if self.state % 2 == 0:
            self.state = self.state // 2
        else:
            self.state = 3 * self.state + 1

    def next_int(self, min_val, max_val):
        """
        Belirtilen aralıkta rastgele bir tam sayı döndürür.
        """
        # Entropiyi artırmak için birkaç adım atlatıyoruz (Isınma turları)
        for _ in range(5):
            self._collatz_step()
            
            # Eğer Collatz döngüsü (4-2-1) 1'e ulaşırsa,
            # akışı bozmak için durumu (state) değiştiriyoruz.
            if self.state == 1:
                self.state = int(time.time() * 1000) + 7  # Tuzlama (Salting)

        # Sonuç hesaplama: Modülo işlemi ile aralığa sığdır
        return min_val + (self.state % (max_val - min_val + 1))

# --- Kullanım Örneği ---
if __name__ == "__main__":
    rng = CollatzRNG()  # Seed otomatik atanır
    
    print("Collatz Tabanlı Rastgele Sayı Üreteci Testi:")
    print("-" * 40)
    
    for i in range(10):
        sayi = rng.next_int(1, 100)
        print(f"{i+1}. Rastgele Sayı: {sayi}")
